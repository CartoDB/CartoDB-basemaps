<!DOCTYPE html>
<html>
<head>
  <link rel="stylesheet" href="http://libs.cartocdn.com/cartodb.js/v3/themes/css/cartodb.css" />
  <!-- include cartodb.js library -->
  <script src="http://libs.cartocdn.com/cartodb.js/v3/cartodb.js"></script>
  <!--[if lte IE 8]>
    <link rel="stylesheet" href="http://libs.cartocdn.com/cartodb.js/v3/themes/css/cartodb.ie.css" />
  <![endif]-->
</head>
<body>
<a href="../">Interactive Map</a><br/>
Portland Street Lights from <a href="https://team.cartodb.com/u/saleiva/tables/saleiva.portland_street_lights/public/map">Sergio's Example</a>
<div id="map" style="height:800px"></div>
<script>

var vizjson = {
    "bounds": [
        [
            45.51945867165255,
            -122.68934726715088
        ],
        [
            45.53497232477052,
            -122.63510227203368
        ]
    ],
    "center": "[45.52721603303253, -122.66222476959227]",
    "description": "Data from <a href=\"http://www.civicapps.org\">Portland Open Data Portal</a>",
    "id": "9f03a894-36c2-11e4-8730-0e8ce8fad357",
    "layers": [
        {
            "id": "92b09907-c2eb-4884-a9c3-069dc12d7b63",
            "infowindow": null,
            "options": {
                "attribution": "\u00a92012 Nokia <a href='http://here.net/services/terms' target='_blank'>Terms of use</a>",
                "base_type": "nokia_night",
                "className": "default nokia_night",
                "id": "92b09907-c2eb-4884-a9c3-069dc12d7b63",
                "maxZoom": 21,
                "minZoom": 0,
                "name": "Nokia Night",
                "order": 0,
                "read_only": true,
                "subdomains": "1234",
                "type": "Tiled",
                "urlTemplate": "https://{s}.maps.nlp.nokia.com/maptile/2.1/maptile/newest/normal.night/{z}/{x}/{y}/256/png8?lg=eng&token=A7tBPacePg9Mj_zghvKt9Q&app_id=KuYppsdXZznpffJsKT24",
                "visible": true
            },
            "order": 0,
            "tooltip": null,
            "type": "tiled"
        },
        {
            "options": {
                "cdn_url": {
                    "http": "api.cartocdn.com",
                    "https": "cartocdn.global.ssl.fastly.net"
                },
                "layer_definition": {
                    "layers": [
                        {
                            "id": "bd77b172-ef52-41d5-a706-c9e59e0fcecf",
                            "infowindow": {
                                "alternative_names": {},
                                "fields": [],
                                "maxHeight": 180,
                                "template": "<div class=\"cartodb-popup v2\">\n  <a href=\"#close\" class=\"cartodb-popup-close-button close\">x</a>\n  <div class=\"cartodb-popup-content-wrapper\">\n    <div class=\"cartodb-popup-content\">\n      {{#content.fields}}\n        {{#title}}<h4>{{title}}</h4>{{/title}}\n        {{#value}}\n          <p {{#type}}class=\"{{ type }}\"{{/type}}>{{{ value }}}</p>\n        {{/value}}\n        {{^value}}\n          <p class=\"empty\">null</p>\n        {{/value}}\n      {{/content.fields}}\n    </div>\n  </div>\n  <div class=\"cartodb-popup-tip-container\"></div>\n</div>\n",
                                "template_name": "table/views/infowindow_light",
                                "width": 226
                            },
                            "legend": {
                                "show_title": false,
                                "template": "",
                                "title": "",
                                "type": "none"
                            },
                            "options": {
                                "cartocss": "/** simple visualization */\n\n#portland_street_lights{\n  marker-fill-opacity: 0.2;\n  marker-line-color: #FFF;\n  marker-line-width: 0;\n  marker-line-opacity: 1;\n  marker-placement: point;\n  marker-type: ellipse;\n  marker-width: 11;\n  marker-fill: #f7eeca;\n  marker-allow-overlap: true;\n  ::center{\n  marker-width: 4;\n  marker-fill: #f7eeca;\n  marker-allow-overlap: true;\n  }\n}",
                                "cartocss_version": "2.1.1",
                                "interactivity": "cartodb_id",
                                "layer_name": "portland_street_lights",
                                "sql": "select * from portland_street_lights",
                                "table_name": "\"\"."
                            },
                            "order": 1,
                            "tooltip": null,
                            "type": "CartoDB",
                            "visible": true
                        }
                    ],
                    "stat_tag": "9f03a894-36c2-11e4-8730-0e8ce8fad357",
                    "version": "1.0.1"
                },
                "sql_api_domain": "cartodb.com",
                "sql_api_endpoint": "/api/v2/sql",
                "sql_api_port": 80,
                "sql_api_protocol": "http",
                "tiler_domain": "cartodb.com",
                "tiler_port": "80",
                "tiler_protocol": "http",
                "user_name": "saleiva"
            },
            "type": "layergroup"
        }
    ],
    "legends": true,
    "map_provider": "leaflet",
    "overlays": [
        {
            "options": {
                "display": true,
                "x": 20,
                "y": 20
            },
            "order": 2,
            "template": "",
            "type": "share"
        },
        {
            "options": {
                "display": true,
                "x": 60,
                "y": 20
            },
            "order": 3,
            "template": "",
            "type": "search"
        },
        {
            "options": {
                "display": true,
                "x": 20,
                "y": 20
            },
            "order": 6,
            "template": "<a href=\"#zoom_in\" class=\"zoom_in\">+</a> <a href=\"#zoom_out\" class=\"zoom_out\">-</a>",
            "type": "zoom"
        },
        {
            "options": {
                "display": true,
                "x": 20,
                "y": 150
            },
            "order": 8,
            "template": "<div class=\"loader\" original-title=\"\"></div>",
            "type": "loader"
        },
        {
            "options": {
                "display": true,
                "x": 10,
                "y": 40
            },
            "order": 9,
            "template": "",
            "type": "logo"
        }
    ],
    "scrollwheel": true,
    "title": "portland_street_lights",
    "updated_at": "2014-09-07T19:39:08+00:00",
    "url": null,
    "version": "0.1.0",
    "zoom": 15
}


function getParameterByName(name) {
    name = name.replace(/[\[]/, "\\[").replace(/[\]]/, "\\]");
    var regex = new RegExp("[\\?&]" + name + "=([^&#]*)"),
        results = regex.exec(location.search);
    return results == null ? "" : decodeURIComponent(results[1].replace(/\+/g, " "));
}

window.onload = function() {
  var lgid = getParameterByName("layergroupid");
  if (!lgid) {
    alert("Need to set url");
  }
  vizjson.layers[0].options.urlTemplate = lgid;
  cartodb.createVis('map', vizjson);
}
</script>
</body>
</html>

